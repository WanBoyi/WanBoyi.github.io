---
layout:     post   				    # 使用的布局（不需要改）
title:      计算机组成原理考研复习笔记				# 标题 
subtitle:   这是我考研复习时计算机组成原理的复习笔记#副标题
date:       2020-04-2 				# 时间
author:     WBY 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 计算机基础
---
# WBY的计组
# 第一章 绪论
### 1.1 计算机发展历程
汇编程序是将汇编代码编译成机器代码的
仍然使用二进制是由物理器件性能所决定的
### 1.2 计算机系统的结构层次
1. 现代计算机结构与冯诺依曼结构区别在于以存储器为中心，过去以控制器为中心
2. CPU区分指令与数据依据是在指令周期的不同阶段
3. IR存放将要执行的指令，PC存放下一条指令的地址
（一个是当前指令，一个是下一条的地址）
4. CPU不包含地址译码器（属于存储器）
5. 解释程序如python运行速度慢
6. 软硬件在逻辑功能上是等效的，不是等价的
7. 相联存储器可以按地址寻址，也可以按内容寻址

向前兼容是：旧程序跑在新机器上
向后兼容是：现在的程序以后也能用
（这两个都是以当下为节点去看，向后是未来，向前是过去）
**兼容性包括了软件兼容性与硬件兼容性**
### 1.3 计算机的性能指标
1. 系列机:使用相同体系结构与指令系统的不同型号的机器
2. 系列机的兼容性有软件与硬件
3. 可移植性是软件容易在两个不同系列中移植
4. 存储系统大小512k*16位，则512k是存储单元的个数，决定MAR的位数，16位是存储单元的大小，决定MDR的位数
5. CPU内部控制器相关寄存器对用户不可见（IR,MAR,MDR）运算器相关的寄存器对用户可见（PC，状态寄存器，通用寄存器）
**机器字长：64位，32位，指的是一次整数运算处理的二进制位数，机器字长与寄存器位数，加法器结构有关，等于内部寄存器的大小**

**数据通路的带宽是数据总线一次并行传送的信息的位数，由总线结构决定**
！！！注意性能指标运算时，时间与速度别混淆
增加，增加到，变成了原来的几倍，提高了几倍
### 1.4 补充点
1. 翻译程序包括编译程序和解释程序
2. 透明性是看不见，对程序员透明是程序员看不见
3. 体系结构是抽象，不涉及硬件，组成是实体，观察硬件
（是否有乘法指令是体系结构，如何实现乘法是组成）
4. 源程序（编译）汇编程序（汇编）目标程序（连接）exe
**！！！**
三种字长都是字节的整数倍
机器字长：与另外两个没有绝对的大小关系，可大可小可等
指令字长：指令字长是存储字长的整数倍
存储字长：一个存储单元的长度
**！！！**
时钟周期：是最基本的单位
指令周期：执行一次指令的时间（取指,间址,执行,中断）
机器周期：CPU完成一次操作的时间
CPU周期：CPU完成一次操作的时间
总线周期：通过总线完成一次读写需要的时间
存取周期：CPU或外设访问存储器一次花费的时间（松）

一个指令周期=n个CPU周期=n*m个时钟周期

# 第二章 数据表示与运算
## 2.1 数制与编码
1. 进制之间会整数与小数的转换
（小数会二进制与十进制之间的转换）

2. 真值，原码，补码，反码的关系
（补码是机器理解的，只有转成原码我们才能得到真值） 
(a-b)补=a补+(-b)补
已知b的补码，则-b补=对b补连带符号位全部取反，末位加一

3. BCD码：用四位二进制表示一位十进制
8421和2421都是按照权值计算的（2421可以四舍五入）
余三码是8421每个加三（8421和大于10需要+6修正）

4. ASCII码是用7位二进制表示128个符号
48-0,65-A,97-a,32-空格

5. 校验码（实际上计网常用，数据链路层用CRC）
编码最小码距L-1=D+C D>=C (检错大于纠错)
    奇偶校验码：一位校验位在头（只能检查一位错误）
    海明码：n+k<=2^k-1 k是校验位（只能纠一位错误）
    CRC：使用除法校验的（只能纠一位错误）

**CRC常用于大规模数据校验，纠错方法不限，可以改正，可以重发，可以删除数据**

## 2.2 定点数表示与运算
**数据在计算及内部都是用补码存储的**
1. 定点数的表示
定点数只有纯小数与纯整数
移码是将补码符号位取反

2. 强制类型转换
char 1B  
short 2B 
int 4B long 4B float 4B
double 8B
相同字长类型转换：不改变数值，只改变了解释方式
不同字长：
    高位截断，低位直接赋值
    低位保持，高位填充符号位

3. 定点数运算
移位运算分为
    算数移位：右移是将真值除2，左移是乘2
    逻辑移位：视作无符号数，移出就丢弃，空位0
    循环移位：带进位与不带进位
加减法运算分为
    原码加减法：判断符号位，数值位直接加减运算
    补码加减法：减法换成加法，如有溢出，溢出位丢弃
符号位扩展运算分为
    原码填入符号位，其他转为原码计算再转回去
溢出判别方式
    一位：溢出位1则溢出
    两位：00与11正常，01正溢出，10负溢出
乘法运算分为
    原码一位乘法：符号位不参与运算
    补码一位乘法：符号位参与
除法运算分为
    原码除法
    补码除法
[借位，进位，溢出]
有借位说明是原码减法运算（符号位与数值位分开运算）
a-b借位是1说明a < b
两数相减在异号的时候不会溢出

5. 补充
0只有一个补码，但是有两个原码与两个反码
移码是对补码的符号位取反

**两负数补码相加，数值位溢出，符号位也溢出，此时计算结果正确，若只有符号位溢出，数值位没有溢出，则逻辑上负溢出了（超出了表示范围）**
**边界对齐是每个数据开始存放的地址必须是偶数**
## 2.3 浮点数表示与运算
1. 浮点数的表示

浮点数表示格式
    N=2^E * M 
    阶符，阶值，数符，数值（数值位数是精度）
规格化浮点数
    左规：尾数左移一位，阶值-1
    右规：运算结果溢出，尾数右移一位，阶值+1
原码规格化表示范围：
    正数：0.1xxx，最大0.1111，最小0.1000 
    负数：1.1xxx，最大1.1000，最小1.1111
补码规格化表示范围：
    正数：0.1xxx，最大0.1111，最小0.1000
    负数：1.0xxx，最大1.0111，最小1.0000
IEEE754标准浮点数
    ms数符|E阶码|M尾数
    （-1）^s* 1.M *2^(E-127)
    double的范围是(E-1023)

浮点运算中，尾数溢出不算溢出，只有阶码溢出才是真溢出

2. 浮点数加减运算
将阶码与尾数分开运算，加减运算必然使用补码运算
对阶
    比较阶码大小，小阶向大阶看齐
尾数求和
    对阶后，尾数直接加减运算
规格化
    对运算结果规格化处理
舍入
    0舍1入：被移去的数值1，则在尾数末尾+1
    恒置1法：不管移去的是1/0,都将末尾数字变成1
溢出判断
    尾数溢出：右移一位，阶码加一
    阶码溢出：01上溢出，进入中断，10下溢，按机器0做
3. 浮点数类型转换
Float转int是只保留整数部分，丢弃小数部分
其他格式转换是内容不变，解释方式发生改变
**注意浮点数有两种格式，规格化和IEEE754，其中规格化是乘以0.m，IEEE754是乘以1.m**
**IEEE754阶码使用移码表示，记住移码取指范围是1~254，尾数使用原码表示**
**重点在于规格化方法，以及对阶时应当向大阶看齐，舍弃精度，以及IEEE754没有阶符的**

**基数是指阶的基数，基数为2的浮点数尾数右移1位，阶码加一，基数为16的浮点数尾数右移4位，阶码加一**

舍入只有浮点数有，定点数没有，浮点数运算只在对阶与右规格化时有舍入
左规格化，阶码-1，右规格化，阶码+1，阶码真值加减后超过表示范围，会出现阶码上下溢出，是真实溢出
[注意题目中的小信息，用的是补码还是原码，阶码位数，表示方式等]
## 2.4 ALU
1. 串行加法器与并行加法器
    串行加法器：是一位全加器，本位进位，输入输出
    并行加法器：将全加器相连，各位同时运算

2. 进位方式
    串行进位：依赖前一级进位（简单）
    并行进位：各个进位信号同时形成（电路复杂）

3. 分组并行方式
    单级先行进位：组内并行，组件串行
    多级先行进位：组内并行，组件并行

4. ALU
ALU核心是并行加法器，同时支持逻辑运算
（输入有选择操作类型，运算类型）

# 第三章 存储系统
### 3.1 存储器的层次化结构
1. 存储器分类
按功能分：主存，闪存，缓存，辅存
按工作方式分：RAM，ROM，串行访问，直接存取

有些存储器交杂的，清楚分类的依据以及每个种类的特点

2. 存储器性能指标
存取时间=存取周期+复原时间
（存取周期是逻辑概念，存取时间是物理的实际概念）
（存取时间是一次读写操作的平均时间，存取周期是两次操作之间的最短时间间隔）

cache效率=访问一次cache的时间/平均访问时间
SRAM与DRAM都是断电易失的特性，但只有DRAM需要刷新
芯片的对外引脚=地址线数+数据线数+读写（2）+片选（1）
**DRAM是地址复用的，即地址线数目减半**

相联存储器有按内存与按地址寻址两种方式
计算机操作系统存在硬盘上，采用RAM与ROM两种方式寻址

### 3.2 层次结构（寄存器，cache，主存，外存）
前三个能直接与CPU交换信息，外存不成，要通过主存
主存与cache之间数据调动是由硬件自动完成的，对外透明
主存与辅存之间由硬件与OS完成的，只对于应用程序员透明
**cache命中率的题目：注意题目中给出主存与cache是否同时访问**

### 3.3 RAM与ROM（外存的磁带光盘两者都不是）
半导体芯片：译码电路，读写电路，存储矩阵组成
RAM是易失性，ROM非易失
RAM可以随机多次读写，用于主存与cache
ROM一般是只读，用于固件，磁盘

RAM分为SRAM（非破坏性读出）与DARM，
Static静态，速度快，造价高，用于cache
Dramtic动态，需要刷新，造价低，用于主存

DARM地址复用，地址信号分两次传送
DRAM刷新有：（以行为单位，需要行地址）
    集中刷新（有死区）
    分散刷新（无死区，增加了存取周期时间）
    异步刷新（缩短了死区时间，减少存取周期）

### 3.4 主存与CPU连接方式
主存通过芯片扩展，有字扩展，位扩展，字位同时扩展
主存与CPU连接，数据线与地址线与CPU中的MAR，MDR连
主存有八片芯片，可以通过三八译码器片选，也可八根线选
**从低向高，先是片内地址，再是片选地址**

### 3.5 双端口RAM与多模块存储器
目的都是能更快的从存储器中读写
双端口是存储器有两个端口，使得两个CPU能同时从中读写
多模块
    单体多字：提高总线宽度，一次读写更多数据
    多体并行：多模块并行查找，地址分为体号与体内地址
    （按照体号在前后，有高位交叉编址，低位交叉编址）
**实现流水，模块数应当大于等于存取周期/总线周期**
[考点在多模块存储器，心中有多模块的样子，知道地址由体号与体内地址组成就成了（一般是考低位交叉编址的流水）]

### 3.6 高速缓冲存储器
时间局部性是由于循环，空间局部性是由于聚簇存储
CPU与cache之间交换数据以字为单位
主存与cache之间交换数据以cache块为单位
cache命中率是计算命中次数占访存次数的比值

**考点：cache与主存的三种映射**
    直接映射：每个数据块在cache中只有一个位置
    全相联映射：没有对应关系，随便放
    组相联映射：[记住这个图]

[题型1]：给出主存地址，要计算对应的cache行号
    1. 先用该主存地址除以cache行的大小，得到所在主存块的块号
    2. 用主存块块号mod cache的行数（组数），即应当在cache行中对应的行数
**考点：主存地址与cache地址的映射**
与上面三种映射关系相对应

[题型2]计算地址映射关系，计算cache的总容量
    1. cache的总容量=存储容量+标记阵列容量
    2. 每一个cache块对应一个标记字段
    3. 按照映射方式计算每一个cache块标记字段的长度

cache主存替换策略：FIFO，LRU（近期最少用），LFU
cache失效率=失效次数/总访问次数 （包括开始全空）

cache的写策略：（读策略就是调度）
    写命中：
        全写法
        写回法
    写不命中：
        写分配：先调入cache，改cache，再写回法进主存
        非写分配：只写入主存，不再调入cache块中

### 3.7 虚拟存储器
将主存与辅存空间统一编址，形成庞大的地址空间
（主存地址指的是实地址，辅存地址也是实地址，对这两种地址统一编址形成虚拟地址）
**这章重点就是虚地址与实地址之间的转化**
三种方式使得主存内容与磁盘内容对应：
1. 页式（简单）
    页表保留在内存中，通过页表找到虚页号与实页号之间的对应关系（还有一位装入位），页表长度固定
    
    虚地址=虚页号+页内地址
    实地址=实页号+页内地址
2. 段式
    段表变长，表项内容=段号+段长+段基址
    通过段号+段表起始地址（基址寄存器）找到段表表项

    虚地址=段号+段内地址
    实地址=段基址+段内地址

    段表特点是具有逻辑独立性，对程序按照逻辑分段，分为数据段，代码段···
3. 段页式
    虚地址=段号+页号+页内偏移
    段表表项=段号+段长+段基址
    页表表项=页号+页内偏移地址
4. 快表TLB
    页表放在主存中
    虚拟地址必须经过页表变换变成主存的实地址
    TLB就是页表的cache，是二级页表（速度快，容量小）
    TLB->页表->cache->主存
### 补充
U盘属于ROM
闪存使用MOS管组成，读比写更慢
MAR位数是整个主存地址空间的位数，要考虑主存空间的扩展
指令cache与数据cache分开存储为了减少流水线资源冲突

访问主存，cache，硬盘三级系统，CPU发送的地址是主存物理地址，CPU不能直接访问硬盘，而是调入主存中访问

虽然CPU发送的是主存地址，但是在访问cache的时候要硬件做地址转换，查表将主存物理地址转换为cache物理地址
（只有在虚拟存储系统中，CPU才发出虚拟地址）
[cache是缓存与主存之间，虚拟存储器是主存与硬盘之间]

只有在虚拟存储系统中才用到虚拟地址，主存与cache中使用主存物理地址

快表根据内容指定地址，一般使用相联存储器
段页式与页式都是以页为单位与主存交换数据

虚存与cache对比：
    1. cache关注速度，虚存关注容量
    2. cache是硬件实现，对所有程序员不可见
       虚存是OS与硬件实现，只对应用程序员不可见
    3. 不命中时，虚存的影响更大
# 第四章 指令系统
### 4.1 指令格式
指令可以扩展（这我会啊）
### 4.2 指令寻址方式
一共十种寻址方式，记住各自的特点
**这章的主要考点也就是这个了**
### 4.3 CISC与RISC
RISC普遍使用硬布线，CISC使用微程序
（硬布线执行速度快，RISC指令大多都在一个时钟周期内）
RISC特点是对于速度要求高，所以必须使用流水
同时减少访存，只有LOAD与STORE指令能够访存，其余指令都是访问寄存器
### 4.4 错题知识点
1. 采用不同寻址方式的目的：缩短指令字长，增大寻址空间
2. 进栈是先动内容再移指针（sp-1->sp），出栈是先动指针（sp+1->sp）再移内容（遇到这样的题目要画图）
**不论栈顶与底位置如何，sp指向的一直都是空的内容**
3. 多道程序设计中最重要的寻址方式是相对寻址
（相对寻址利于程序在内存中浮动）
[留下了几个计算数字的选择没有整]


# 第五章 中央处理器
### 5.1 CPU功能与基本结构
功能：指令控制，操作控制，时钟，数据加工，中断
结构：运算器，控制器

比较重要的寄存器：
运算器：通用寄存器，状态字寄存器（PSW）
控制器：PC(可见)，IR，MAR,MDR（不可见）
运算器的两个是可见的，控制器只有PC是汇编可见的

堆栈寄存器SP属于通用寄存器组，指向栈顶地址
（sp指向的是空的，且高地址在栈底，低地址在栈顶）

PC的值会在取指周期末+1，在执行周期中跳转
转移指令中，达到条件PC才会转移，否则+1

### 5.2 指令执行过程
指令周期四个阶段对应四个触发器，表示当前指令周期阶段

取指周期是根据PC内容取指令放在IR中
间址周期是将操作数有效地址放在MDR中
执行周期是译操作码，对操作数进行操作
中断周期：处理中断
    1. SP-1存入主存，PC存入主存
    2. 将中断程序入口地址送入PC执行

DMA传送一次数据要占用一个存取周期
（存储器存取一次花费的时间）

指令间接寻址分为一次间接，两次间接，多次间接
或者按照寄存器间接，存储器间接寻址

不是每个指令周期都包含中断周期，执行周期结束后，只有当出现中断请求时，才会进入中断周期

机器周期是n个时钟周期，是CPU完成一次基本操作的时间，这个基本操作是访问一次主存或者IO，所以机器周期通常由存取周期确定
**这章里面总提到存取周期概念，但是没有严格定义，大致了解存取周期的描述**
### 5.3 数据通路的功能与基本原理
数据通路是逻辑概念，指CPU内部数据传送路径，不只关注源与目的，也关注途经的寄存器（数据通路不含控制部件）

三种数据通路：
单总线，三总线，专用数据通路

数据通路不止传送数据，也传送读写控制信号，控制信息流向与读写类型

ALU两个进口有一个要接暂存器

数据通路关注数据冲突，性能，硬件量
这三种想明白各自的特点
### 5.5 指令流水线
在这里将指令执行过程又分成三个阶段
取指：根据PC地址从主存取指放到IR中
分析：对操作码译码，取出操作数
执行：执行运算，将结果写入主存或寄存器

流水线可以实现在单CPU中并行执行多任务

流水线特点
1. 每个功能部件有个锁存器保存本段结果
2. 各功能段时间尽量相等，否则会堵塞
3. 流水线在装入与排空时候效率最低

流水线分类：静态动态，单功能多功能，线性非线性
（反馈回路，递归过程）

流水线三种冲突：
1. 资源冲突（结构相关）：争用资源
    方法是等待
2. 数据冲突（数据相关）：必须先A后B
    等待，数据旁路技术，编译器优化
3. 控制冲突（控制相关）：转移
    分支预测，提前生成条件码
**数据冲突与控制冲突是考点，要知道处理方法**

流水线三种指标（会画图计算）
吞吐率，加速比，效率

超标量流水线技术：
超标量，超流水，超长指令字（要多个处理部件）
### 5.4 控制器功能与基本原理
最大的区别：微程序是封装在CM中调用微指令，硬布线是指令直接由硬件与时序逻辑完成（感觉像是微程序多了一层）

硬布线控制器（速度快，硬件量大，精简系统）
1. 原理：
根据指令操作码，时序，状态标志，按时间顺序发送一系列的微操作控制信号，本身由逻辑门电路与触发器组成的

2. 各个周期工作
    取指周期：根据PC（经MAR）取出指令放到IR中，PC+1
    间址周期：根据指令从内存中取出操作数放到MDR
    执行周期：访存指令，运算指令，转移指令都不同

3. CPU控制方式
同步，异步，联合

微程序控制器（速度不快，但规整好改进，复杂系统）
1. 原理
将一条指令拆成一堆微指令，没有四个周期，封装好了微指令的顺序，交给下面一层处理
2. 基本概念
**机器指令=1个微程序=n条微指令=n*（m个微操作）**
 1.微操作与微命令：最小最基本的单位，一一对应
 2.微指令与微周期：就是指令与周期的缩小版（基本一致）
 3.微程序与程序：一条指令一个微程序，一个程序一堆指令
 4.主存与控存(CM)：CM在CPU内，由ROM实现，写死了
3. 过程
取微指令公操作，将微程序入口地址给CMAR，逐条取指执行
4. 实现
每条指令对应一个微程序，程序员在CM中写好了，取指令的公操作是一段微程序
有n条指令，就有n+2个微程序（取指，中断公操作）
5. 微指令编码方式
直接编码：不用译码，一位是一个
字段直接编码：分段，需要译码，每段加一位说明本段有用
字段间接编码：分段
6. 微指令地址形成
微指令的下地址字段给出，机器指令操作码形成
（开机第一条微指令地址是取指周期微程序的入口地址）
7. 微指令的格式
水平型：比较宽，一位是一位的（一次可有多个硬件操作）
垂直型：和指令相似（一次只有一个硬件操作）
8. 动态与毫微程序
动态是CM中的微程序可以改写
毫微是在微指令与硬件中又加一级毫微级


# 第六章 总线
### 6.1 总线概述
总线传输周期=总线周期
总线时钟周期=机器时钟周期（最小的那个）
猝发传送（burst）：一个总线周期内传送地址连续的多个数据字（给个首地址，读写多个单元的数据）
间接寻址首次得到的地址也是通过数据总线传送给CPU的
    单总线：CPU 主存 IO 挂在一条上
    双总线：主存总线与IO总线分离
    三总线：CPU，主存，IO之间形成三角形（多一条DMA）

区分计算：总线带宽，总线宽度，数据传输速率
### 6.2 总线仲裁
多个外设争用总线控制权，向总线控制部件发请求
控制线：（**设备地址线数量是考点**）
链式查询是3条，定时器查询logn+2条，独立请求2n+1条
（两条是总线忙与总线请求，多出来的是设备地址线）

知道三种方式的优缺点（复杂度，线的数目）
### 6.3 总线操作与定时
总线阶段：申请，寻址，传输，结束
异步定时三种，通信信号数目分别是1,2,3
同步速度快，异步用于速度相差较大的设备

### 6.4 总线标准
ISA是系统总线，PCI是局部总线（即插即用）（外围）
SATA是串行接口，USB是串行总线，PCI是串行总线
### 6.5 补充
总线上一个时刻只能有一对主从设备通信


# 第七章 IO系统（还是有点乱）
这一章结合OS的内容一同复习
### 7.1 IO系统基本概念
外设，接口，外存定义
IO有四种方式：程序查询，中断，DMA，通道
IO接口=设备控制器
IO端口是IO接口的寄存器
IO地址可以与内存地址统一编址，但是IO指令与通用指令格式是不同的
（IO接口统一编址时，进行IO操作使用访存指令）
**IO指令的数据传送发生在通用寄存器与IO端口之间**
### 7.2 外部设备（只有计组关心）
基本上就是磁盘的计算题，计算数据传输速率之类
### 7.3 IO接口（设备控制器）
内容包括结构与功能
结构分为对内对外，功能是协调速度（数据，状态，地址）
（心中知道接口的结构与功能）
### 7.4 IO方式（计组+OS的通道方式）
重要的是中断与DMA方式
查询：一个一个问，浪费CPU时间

中断：
中断分类（软硬，内外）（访管指令优先级也比较高）
响应条件
隐指令
中断向量

处理过程：先硬件执行隐指令，再保存现场，再执行中断服务程序

保存断点是PC的值（隐指令），保存现场是状态字寄存器（中断开始时候）

中断响应优先级：如链式查询，由硬布线硬件直接决定的
中断处理优先级：中断嵌套的优先级，由中断屏蔽字决定

DMA与通道都是硬件方式，中断是软件IO方式

DMA：
特点：中断要CPU，DMA要总线
过程：预处理（送地址，开设备），数据传送，后处理（要中断）

DMA与中断对比
DMA不用保存恢复现场
DMA可发生在指令周期任何一个阶段
DMA优先级高于中断
DMA用硬件传输，中断用程序传输


DMA与通道对比
通道完成一组数据块传输，DMA完成一块传输
CPU向通道发一条IO指令，通道自己开始传输（结束时中断）
DMA传输数据块大小位置由CPU决定，通道自己决定的
DMA控制器对应一台设备，通道可对应多台设备
### 7.2 IO层次结构（总结上面的所有内容+软件内容）
IO系统是分层次的，从用户到硬件四个层次。
（计组部分研究硬件=设备+设备控制器（接口））
用户级软件，设备无关软件，设备驱动程序，中断处理程序
### 7.5 IO核心子系统（缓存与缓冲区）
OS中虚拟外设：将一个物理设备变成多个对应的逻辑设备
通道控制IO接口，IO接口控制IO设备
