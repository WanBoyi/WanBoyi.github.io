---
layout:     post   				    # 使用的布局（不需要改）
title:      计算机网络考研笔记 				# 标题 
subtitle:   这是我考研时总结的一点计算机网络的基础知识 #副标题
date:       2020-04-02 				# 时间
author:     WBY 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 计算机基础
---
# WBY的计网
# 第0章 计网体系结构
广域网使用交换技术，局域网使用广播技术

总时延=发送时延+传播时延 (+处理时延+排队时延)
传输时延=发送时延：发送该数据帧所用的时间
传播时延：数据在信道中传输所花的时间

最高速率叫做带宽（一般都达不到最高速率）

物理层是最底层，应用层是最高层（向下封装，向上拆包）
传输层是端到端，网络层是点到点（TCP与OSI都有的层）

路由器：在网络层与传输层工作
网桥：链路层，使用MAC地址转发帧（连接两个局域网）
交换机：链路层，能自己学习地址情况，是多端口网桥
中继器：又叫hub，物理层，只有放大信号的功能
集线器：物理层，是多端口hub，有放大与转发

每一层使用下层的服务都是通过服务访问点实现的

广播式网络可以不用网络层（点对点）

分层是抽象概念，不涉及具体实现技术，只将功能分层

因特网的核心技术是TCP/IP

各层的功能：
    物理层：传输单位比特
    链路层：成帧，差错控制，流量控制(顺序与完整)
    网络层：点到点
    传输层：端到端
    会话层：建立会话，数据同步
    表示层：信息的表示与编码
    应用层：为用户提供服务

中继系统设备划分：
    物理层：集线器，中继器
    链路层：网桥，交换机
    网络层：路由器
    再上层：网关

路由器有MAC地址，网桥与交换机没有
路由器或者主机可以是下一跳地址，网桥与交换机不行

协议常用端口号：
**客户端端口号自己定，服务器端口号是固定的**
    FTP：21
    TELNET：23
    SMTP：25
    DNS：53
    HTTP：80

TCP报文首部：20B
UDP报文首部：8B
IP报文首部：20B
以太网帧最小长度：64B，数据部分46B

通信子网：(下三层)
    物理层，链路层，网络层
资源子网:（上三层）
    应用层，表示层，会话层

应用层：报文
传输层：报文段
网络层：分组，数据包
链路层：帧
物理层：比特流

IP地址=网络号+主机号（网络层）
MAC地址定位到主机（链路层）
端口号定位到进程（传输层）
[工作的层次不同]

IP层只校验首部，不校验数据部分，传输层都要校验
不论是传输层还是链路层，[滑动窗口]都是[流量控制]

计算机网络：用户面对一台计算机，登录运行
分布式系统：各个计算机对用户透明，OS选一台为用户服务

-----------------------------------------------
**总体**
[应用层协议使用TCP/UDP以及各自的端口号见P266#]
[以太网802.3、令牌环网.5、光纤.8、无线局域网.11]

# 第1层 物理层
计算传输率：（不要慌，就这几个量，套相应公式即可）
    理想信道：奈奎斯特=2wlog2v  只与带宽有关
    噪声信道：香农=wlog2（1+S/N）与带宽,信噪比都有关
**v是每个信号的物理状态数，套用公式即可**
**计算噪声信道的传输率，取两种方式的最小值**
**码元的位数=log2(有效离散值)**
**传输速率=发送速率，与传播速度无关**
**计算完成数据传输时间=发送时延+传播时延**

编码：曼彻斯特波形
调制：···

电路交换：（数据传输时延最小，没有差错控制）
报文交换：（时延最大，不能实时通信，无最大长度限制）
分组交换：（与报文交换都使用存储转发，速度介于12间）
    数据报：分组无序（不出错，时延大，没有差错控制）
    虚电路：分组有序可靠（没有差错控制，时延小）
**注意题目，一旦提到了分组，就最后两种里选**

物理层接口特性：
机械特性：物理连接引线的数目，规格，排列状况
电气特性：电压高低，阻抗，传输速率，距离限制
功能特性：电压的意义，用途
规程特性：工作规程与时序关系

物理层是第一层，关注比特流，传输媒介是第0层

基带传输：不调制就传输
频带传输：对载波调制
宽带传输：对频带频分复用，划分信道

--------------------------------------------
计算机内部数据传输是并行传输的

波特率定义是每秒信号的变化次数（可以转化为比特率）

**以太网**
    以太网属于局域网，是广播网
    以太网使用分组交换技术
    以太网采用曼彻斯特编码，2波特=1b/s(降低了效率)
    以太网中最多有四个中继器来扩充网段
    以太网最短帧长=64B

同轴电缆有更高的屏蔽性与抗噪声性
但是光纤不受电磁干扰与噪声影响（光的全反射）
（单模光纤直径等于光线的波长，光沿直线传播）
（多模光纤利用了光的全反射）
卫星通信特点是：费用高，时延大

两个网段在物理层互联时，数据传输速率要一致，链路层协议可以不同（低相同，高不同）

转发器作用主要是放大信号（而非转发）
集线器连接的网络拓扑结构是星型，作用是转发与放大信号
集线器一个端口收到数据后，从其余端口转发出去

---------------------------------------------

# 第2层 数据链路层（帧）
## 2.1 数据链路层的功能，组帧，差错控制
链路层有差错控制：位出错，帧出错

链路层对上层提供三种服务：
    无确认无连接，有确认无连接，有确认有连接

组帧是为了出错时只重发错误帧，不必重发全部数据
组帧时需要为帧增加头尾定界

检错码：奇偶校验码，CRC校验码
纠错码：海明码
海明距离（码距）：1110与1000有两位不同，海明距离是2
[海明码纠错n位，需要2n+1编码方案，检错n位，码距d+1]
[海明码：k比特信息位，r比特冗余信息，满足2^r>k+r+1]
CRC编码计算冗余码，加到信息码的最后

---------------------------------------------
## 2.2 流量控制（滑动窗口机制）
链路层流量控制是点对点，传输层流量控制是端对端
链路层控制流量：未收到就不回复ACK
传输层控制流量：给发送端一个窗口公告

[链路层窗口大小是固定的]

三种协议实现流量控制与可靠传输：（三种ARQ）
停止等待：(1,1)确认后才能发下一帧（利用率低）
go-back-N：(n,1)累计确认，回滚N帧
选择重传：(m,n)接发都有缓冲区，只重发错误的

**窗口大小的计算（与ARQ类型有关）**
[发送窗口>=接收窗口（选择重传时相等）]
[发送窗口+接收窗口<=帧编号个数]
发送与接收窗口的尺寸：n比特对帧编号
GBN发送窗口1~2^n-1, 选择重传发送与接收窗口2^(n-1)
滑动窗口大小=n，则最多同时有n-1帧已经发送但没有确认

**速率与利用率的计算（与ARQ类型无关）**
1. 信道利用率=发送时延/（发送时延+2*传播时延）
[一般不考虑确认帧的开销]
2. 发送窗口的长度=从发送到收到回复的时延/发送一帧时间
3. 帧序列比特数=log2发送窗口的长度

-----------------------------------------------
## 2.3 两种介质访问控制（信道冲突）
介质访问控制：一条信道一个时刻两对儿以上在通信，会相互干扰，想办法解决干扰

静态划分信道：

    1.信道划分：（不会发生冲突）
        频分FDM：傅里叶变换
        时分TDM：时间片，STDM只有要发送时才给时间片
        [TDM介质速率大于信号速率，(统计)STDM是等于]
        [介质速率就是理论带宽，信号速率是实际速率]
        波分WDM：不同波长光信号 
        码分CDM：采用不同编码，CDMA是码分多址

    2.随机访问：（冲突需要检测与避免）
        ALOHA：纯ALOHA，时隙ALOHA
        CSMA：1-坚持，非坚持，p-坚持
        CSMA/CD:拥塞信号，碰撞检测
        CSMA/CA:碰撞避免
动态划分信道：
    轮询访问：轮询节点，令牌传递，有令传送
[令牌环网适用于负载重的网络环境]

**二进制指数避退**
第i次碰撞后，应当在0~2^i-1之间选择一个随机数
当碰撞次数大于10也按照10处理
将选出来的随机数*2倍传播时延
当传播16次仍然不成功，就放弃重传，向高层报错
[该算法考虑了网络负载对于冲突的影响]
[当重传次数越多，发生冲突的概率越低]

**码片序列的计算**
码分复用划分信道，ABC的码片序列是
(1,1,1,1)(1,-1,1,-1)(1,1,-1,-1)相互正交
C接收到序列为(2,0,2,0,0,-2,0,-2,0,2,0,2)
先划分(2,0,2,0)(0,-2,0,-2)(0,2,0,2)
再都与A做点积，得到4,-4,4 
即c收到A发送的数据是101

**避免与检测的特点**
碰撞避免使用了 ACK帧，预约信道(RTS/CTS帧可选)
碰撞检测用于有线信道，碰撞避免用于无线信道

**计算碰撞检测的时延**
碰撞检测争议期，即冲突检测时间是：信号在两个端点之间往返传输时间
[往返时延（传播时延）=发送时延=最小帧长/发送速率]
[当发送时延改变时，要么将该时延变回去，要么变往返]

-------------------------------------------------
## 2.4 数据链路层的设备
网桥就是连接两个网段的连接设备，交换机是多端口的网桥，可用端口增加总带宽

链路层设备可以隔离冲突域，不能隔离广播域
网络层设备可以隔离冲突域与广播域
物理层设备都无法隔离
[交换机的带宽问题：每个连接点的带宽等于端口带宽]
[交换机总容量是同时最多多少数据流量，考虑半双工端口数/2]

当问使用交换机还是集线器时，交换机的作用是在局域网内隔离冲突域，局域网内通信越频繁，越应当使用交换机

交换机工作在物理层与链路层
网桥工作在数据链路层的MAC子层上
路由器工作在网络层上

时延：
集线器<交换机<网桥<路由器

--------------------------------------------
## 2.5 局域网与广域网
局域网特点：所有站点共享带宽，能够广播与组播
OSI中链路层：LLC逻辑链路子层 + MAC介质访问控制层
LLC是高层，会给帧加序号
### 2.5.1 局域网与以太网
1. 以太网特点：
    逻辑上总线结构，物理上是星型结构
    在总线上将信息以广播方式发送
    以太网无连接，没有帧编号，没有ACK，提供不可靠服务
    以太网使用曼彻斯特编码
    介质访问控制方式是CSMA/CA

2. 高速以太网分类：[注意传输速率基本单位是b/s]
    10Base-T以太网：100Mb/s 使用双绞线，有全半双工
    G比特以太网：1Gb/s 双绞线或者光纤，全半双工
    10G比特以太网：10Gb/s 使用光纤，只有全双工

3. 网卡：
    网卡在链路层，是电脑与网线的接口，网卡有MAC地址

4. MAC帧的格式：
    在MAC层最小是64B，在物理层要加8B的前导码

5. 无线局域网：
    按有无基站分类，所有域内结点都要连接基站与外通信
    基站又叫接入点AP，基站通过portal门桥与其他连接

6. 令牌环网：
    有个令牌在传递，只有持有令牌的才能够发送信息
    适用于负载很重的网络

广播风暴是每台主机都要处理信息，降低了网络的效率
无线局域网一般使用CA避免，因为探测消耗高，还有隐蔽站
有线网一般使用CD，比较成熟
以太网中ABCD,A发送数据，则ABCD都有可能接受到数据
令牌环网，每个节点持有令牌的时间有限，不能一直持有
令牌环网最坏等待时间=其他节点传送令牌与发送帧的总和
[当有拿不准的知识点，想想合理性，是否有重大缺陷，比如令牌若能够一直持有，信道的利用率就不高]
### 2.5.2 广域网
广域网概念：
    广域网是相对于局域网的概念，范围较广，跨洲跨洋
    因特网就是广域网的实例
    广域网工作在物理层，链路层，网络层
    广域网使用[分组交换技术]（局域网使用广播技术）
    广域网的传输方式是存储转发方式
    广域网侧重于资源共享（局域网侧重于数据传输）
    广域网的协议是PPP协议与HDLC协议

1. PPP协议（点对点协议，面向字节，只支持全双工）
    **面向字节是说所有帧的长度都是整数个字节**
    不用纠错（可以检错），不用流量控制
    不用序号，不支持多点链路[不可靠]
    透明传输：也就是对上层封装抽象了定界符
        同步传输使用比特填充
        异步传输使用字节填充（默认）
    PPP提供三种功能：
        LCP：用于配置，测试，管理数据链路
        NCP：为网络层建立与配置逻辑连接
        一种成帧方法

2. HDLC协议（面向比特，只支持全双工）
    [HDLC是ISO制定的，不属于TCP/IP协议族]
    使用CRC检验，检错不纠错，不用流量控制
    对帧进行编号，有确认机制[可靠]
    采用比特填充**每5个1就插入一个0**
    HDLC有三种类型的帧：“无奸细”
        无编号帧，监督帧，信息帧

PPP与HDLC都是链路层协议

互联网与广域网
    网络分为局域网与广域网，从互联网的角度看是平等的
    互联网可以连接广域网与局域网，使用路由器连接
    广域网不能通过路由器连接不同类型的网络
    **因特网是互联网的实体，互联网是因特网的概念**

---------------------------------------------
# 第3层 网络层（IPV4与路由算法是核心）
## 3.1 网络层功能
1. 异构网络互联：连接网络（链路层与物理层都不同）
2. 路由转发：路由器工作在网络层
3. 拥塞控制：流量控制是两点问题，拥塞控制是全局问题

路由器互联的多个局域网：
    物理层、链路层、网络层可以不同，高层协议必须相同
## 3.2 路由算法
路由器有路由表与转发表
路由表是反映网路线路情况的，转发表是具体应用的
路由算法是路由器通过链路状态计算路由表

动态路由有两种算法：
1. 距离-向量路由算法：（局部）
    定期将整个路由表给相邻节点，RIP算法
2. 链路状态路由算法：（全图）
    主动测试相邻节点，发给其余所有节点，Dijstra算法
[距离-向量算法会有慢收敛问题，是回路的根本原因]

分层路由：
将互联网分为小的自治系统AS，系统自己决定采用什么协议
    AS内部协议IGP：RIP，OSPF协议
    AS外部协议EGP：BGP-4协议
**OSPF将自治系统内部再分为若干区域，每个路由器只知道本AS如何给目的路由器，不知道其他区域细节，适用于大规模自治系统**

路由器有两种交付方式：
    1. 直接交付：源与目的在同一个网段内
    2. 间接交付：源与目的在不同网段内
    [网段内使用相同的子网地址]
    [之前的路由器都是间接交付，最后的是直接交付]
## 3.3 IPV4
IPV4格式
1. 固定长度20B，首部是4B整数倍
2. 协议字段：TCP=6，UDP=17
3. 基本单位：“一种八片首饰”
    {总长度1B，片偏移8B，首部4B}
4. 分片用的字段：（当数据报长度超过MTU要分片）
    [MTU是以太网帧最大传送数据单元]
    标识字段：同属一个数据报就使用相同标识
    标志字段：MF=more分片，DF=don't分片
    片偏移字段：分片在分组中的相对位置

IPV4地址
1. 地址分5类：0,10,110,1110,1111对应ABCDE
2. 除了开头的标识，后面=网络号+主机号
3. 主机号：全0表示该网络本身，全1表示该网络广播地址
4. 0.0.0.0是本网络本主机，255.255.255.255是全网广播
5. 127.0.0.0是环路自检地址，是任意主机自身

IP地址特点[网络号与主机号]
1. IP地址=网络号+主机号
(网络号由管理机构分配，主机号由网络内的单位自行分配)
2. 路由器只看[网络号]转发分组，不必看[主机号]
3. 使用转发器，网桥连接的LAN是同一网络，有相同IP地址
4. 使用路由器连接的是不同网络，路由器每个端口有个IP址
5. 同一局域网中的网络号都相同=路由器该端口的网络号

### 3.3.1 网络地址转换NAT（一址多用）
将私有IP地址转换为公用地址，可以一址多用
方法：
1. 私有地址不合法，将一个公有地址对应转换
2. 私有地址只能用于局域网，在局域网路由器装上NAT软件，路由器对外端口有合法IP地址
3. 路由器内部有NAT转换表，根据端口号转换为域内地址
(一般路由器只看网络号，NAT路由器要看IP地址与端口号)

### 3.3.2 子网划分CIDR
将网段细化分类，可以节省IP地址，减少广播风暴
[从节流的角度增加IP地址，其余是开源的方式]
原本IP地址={<网络号><主机号>}
**子网划分后={<网络号><子网号><主机号>}**
[子网号是从主机号中借来的]
[分清楚网络号，子网号，主机号，网络号与ABC类地址有关]

知道子网掩码，通过IP地址计算子网网络号
通过子网掩码可直接计算该子网能够分配的主机数
（主机号位数-2[主机号全0是本网号，全1是广播地址]）

使用子网掩码的路由器分组转发算法：
1. 计算子网地址，看是否有相同的子网地址（直接交付）
2. 给特定主机路由的下一跳地址
2. 查看路由表，转发给掩码相同的下一跳路由器
3. 给默认路由
4. 丢弃，报告出错

CIDR消除传统ABC类网络划分，使用超网
**CIDR的IP地址={<网络前缀><主机号>}**
表示方法：128,14,32,5/20 
[说明子网掩码是20位，计算该子网网络前缀128.14.32.0]

可将CIDR的IP地址通过路由聚合构成超网
[路由聚合是将两个子网地址合并成为一个前缀更短的地址]
[但在查询路由表时，应当找有最长前缀的路由
**CIDR中主机号[最大可分配地址个数]能够全0全1**

### 3.3.3 ARP，DHCP，ICMP协议
三个协议的作用：
    ARP：IP地址与MAC地址的映射[网络层]
    DHCP：动态分配IP地址[应用层，广播，UDP，C/S]
    ICMP：报告差错与异常[网络层]
**ARP处在网络层的底层，为整个网络层提供服务**
**DHCP与ICMP处在网络层的上层，为上层提供服务**

1. ARP:IP地址与MAC地址映射
原因：
    在实际链路上传输必须要有MAC地址

工作过程：[只写了AB在同一个LAN上]
    A向B发送帧，填入自己与对方的IP地址，自己的IP地址
    查看主机内的ARP高速缓存，看有无与对方IP对应的MAC
    如果没有，使用FFF填充对方MAC地址，广播该请求分组
    B接收到请求分组，发送响应分组，有自己的IP与MAC
    A接收到响应分组后，将该条对应关系写入ARP缓存

实际有四种应用情况：
    [AB在同LAN使用一次，在不同LAN要使用n+1次]
    A与B在同一个LAN，A通过ARP协议找到B的MAC地址
    A与B不在同一个LAN：
        A通过ARP找到一个路由器的MAC
        该路由器X用ARP找到下一条路由器Y的MAC
        路由器Y通过ARP找到B的MAC
    **在这里路由器也叫作网关**

2. DHCP：动态分配IP地址
特点：
    基于UDP，CS模式，广播方式交互，IP地址是非永久的
    手机：  “有没有DHCP服务器？”
    服务器：“有！有！有！这个IP地址您看行不行？”
    手机：  “那我就用这个IP地址了！”
    服务器：“好的，下次再来啊！”

3. ICMP：目标主机与路劲中路由器向源主机报错
    分为询问报文与差错报文
    （询问报文4种，差错报文5种）
### 3.3.5 IPV4补充
IP分组首部定长20B，但是分组头不定长
IP分组协议字段，TCP6，UDP17
网络层只检查首部，传输层数据部分也要检查
IP分组在分片之后会在目的主机重组
[详细看分组格式就是IP报与TCP报，IP重点在分片，TCP重点在ack与seq]
一种八片首饰，记住，一定会考的
IP分组传输过程中经过多个路由器，原IP与目的IP始终不变
ARP请求是广播发送，ARP响应是单播发送
ARP在底层，IP在中间，ICMP与DHCP在上层
ICMP报文封装在IP数据报中发送，与链路层无关
ICMP有询问报文，差错报告报文（其中源点抑制控制拥塞）

----------------------------------------------
计算题
1. 地址，掩码，主机数···

## 3.4 IPV6
1. IP地址耗尽有三种解决方式:
    使用CIDR编址
    使用NAT一址多用
    使用IPV6有更多地址用于分配

2. IPV4与IPV6：
    V4有32位，V6有128位
    V4地址是4B整数倍，V6是8B整数倍
    V4可在路由中分片，V6不允许分片（或源节点分好）
    V6关键特征在于身份验证与保密功能
    V4协议与V6协议不兼容，但与其他英特网协议兼容
    V4使用点分十进制表示，V6使用冒号十六进制

3. v4向V6两种过度方式：
    双协议栈：路由器有两个协议栈可以同时工作
    隧道技术：将整个V6报文封装在V4数据部分，用V4网络
## 3.5 路由协议
路由选择协议分为两种，在自治系统AS内部的，与外部的
    AS内部（IGP）：RIP协议，OSPF协议
    AS之间（EGP）：BGP协议
    [RU,OI,BT]

1. RIP协议[最简单，路由选择协议]
    基于：距离-向量算法
    RIP路由表表项[目的网络N，距离d，下一跳路由器X]
    维护的是从自身到其他目的点的唯一最佳距离
    最多15个路由器，适用于小型的网络，16表示不可达
    **仅与相邻路由器交换信息，交换的是自己的路由表**
    **RIP是应用层协议，使用UDP传数据，每30s发一次**
    **网络出现故障时，要几分钟后才知道，是慢收敛的**

2. OSPF协议[开放最短路径]
    基于：链路状态算法[Dijistra]
    每个路由器使用洪泛法向所有路由器发送（广播）
    发送的信息是与本路由器相连的所有路由器的链路状态
    只有当链路状态发生变化时才会发送
    [适用于规模较大的网络，收敛速度快]
    **每个路由器都有网络的完整拓扑结构，使用Dj算法计算出本节点到其他所有节点的最短路径**
    **是网络层协议，使用IP数据报封装**

3. BGP协议[边际网关协议]
    基于：距离-向量算法
    不同AS内的发言人之间交换信息
    交换的内容是**到某个网络所经过的AS**
    只有在链路状态发生变化时才会交换
    [BGP是应用层协议，借助TCP报文传送，要可靠传输]

路由收敛指的是：路由表与拓扑结构能够保持一致

## 3.6 IP组播
属于同一组的主机都使用同一个组播组地址
组播地址只能作为目的地址，源地址必须是单播地址
组播使用UDP，尽最大努力交付数据
组播不产生ICMP查错报文
并非所有D类地址都可以作为组播地址
## 3.7 移动IP
## 3.8 网络层设备
路由器有两部分组成：
1. 路由选择
    构造路由表[根据路由选择协议]
    更新与选择路由表
2. 分组转发
    由输入口，交换结构，输出口组成
    交换结构根据[转发表]选择出口输出

路由器输入输出：
    比特流-帧-IP数据报-帧-比特流
    [所以路由器工作在三层]

路由选择：当收到RIP，OSPF报文，交给路由选择部分处理
交换部分：当收到一般分组，根据转发表直接转发

路由表：由路由选择协议计算得到的
转发表：由路由表计算得到的，与路由表表项一一对应

直接交付：路由器将分组直接交付给主机
间接交付：路由器将分组交付给下一台路由器

路由器：可连接两个不同网络层协议的网段
网桥：可连接两个链路层，物理层不同的网段
集线器：不能连接两个物理层不同的设备
[中继器是直通式设备，不是联通式设备]

物理层：中继器，集线器，不能隔离冲突域，广播域
链路层：网桥，交换机，能隔离冲突域，不能隔离广播域
网络层：路由器，能隔离冲突域与广播域

路由器传输延迟也是最大的
路由器最佳路由一般使用最短传输距离
路由器中默认路由的目的地址与子网掩码都是0.0.0.0
路由器检测到拥塞时，可丢弃分组，发送ICMP报文
路由器会对IP报文首部进行差错校验

**路由器内的输入/出缓冲队列溢出是分组丢失的重要原因**

# 第4层 传输层（重点在TCP）
**记住TCP三次四次握手，ack，seq，拥塞控制图**
## 4.1 传输层提供的服务
网络层与传输层对比：
    网络层是点到点，传输层实现端到端
    传输层对整个报文进行差错检测，网络层只对首部检测
    网络层只能提供无连接不可靠，传输层提供两种

端口是进程与运输层的接口，SAP是服务访问点
    链路层SAP：MAC地址
    网络层SAP：IP地址（v4：32位，v6：128位）
    运输层SAP：端口号（16位）

套接字socket=主机IP地址+端口号

[传输层分用指的是接收方剥去报文首部，能将数据正确交付给目的进程]
传输层发送时叫做分用，接受时叫做复用

TCP不提供广播与组播服务
TCP适用于qq的大文件，速度慢，可靠
（速度慢是由于需要加更大的首部，开销更大）
UDP适用于消息的小文件，速度快

--------------------------------------
## 4.2 UDP协议
在IP上加了两个功能：
    多路复用
    错误检查

UDP是面向报文的，即报文是完整单位，不能够分割与合并

UDP的首部格式：
    2B源端口号，2B目的端口号，2B长度，2B校验和

UDP的伪首部不会发送，伪首部只用于校验，不会发送

UDP的校验对整个报文校验，包括数据部分，校验和填入首部
[若计算结果为0，则校验和字段填1]

--------------------------------------
## 4.3 TCP协议
TCP协议
    特点：可靠，有序，无丢失，不重复
    [TCP使用全双工，将数据视作字节流]

TCP缓存：
    发送方缓存：准备发送的+已经发送未被确认的
    接收方缓存：按需到达未被读取的+未按序到达的

TCP首部结构：
    IP首部重在分片传输
    UDP只有地址，长度与校验和
    TCP重在序号与确认号，以及缓存情况
    （TCP首部保持通信，有序接收）

**虽然TCP是面向字节的，但是对报文段进行确认的**

TCP三次握手建立连接，四次握手释放连接
**最好是记住这个图**
（TCP是C/S架构，发起连接的就是客户，但客户与服务器端都能够先提出释放连接）

TCP建立连接使用的首部字段：（三个bool，两个int）
    SYN：请求链接，同意链接[连接的前两条]
    ACK：表示ack字段有效[连接的后两次，释放的后三次]
    FIN：表示自己数据发送完毕，要释放[释放的两条]
    ack：按字节编号，本报文的第一个字节序号
    seq：期望对方发送的报文的ack号

--------------------------------------
## 4.3.1 TCP可靠传输
1. 使用序号seq与ack
seq与ack都建立在字节流上，seq是将要发送的报文首字节编号，ack是期待接收字节的编号[使用累计确认的方式]
2. 重传机制
    超时重传：
        发送一报文时计时器置0，重传时间RTT到期即重传
        RTT取多次往返时间的加权平均值
    冗余ACK：[快速重传]
        当发送ack=x，期望收到对方seq=x的帧
        但是收到了y>x的帧，立即连发三个冗余ack帧
        冗余帧ack=x，表示该帧丢失，希望对方立即重发

--------------------------------------
## 4.3.2 TCP流量控制
发送方与接收方之间通信，限制发送速率（点对点）
**链路层的窗口大小是固定的，传输层的窗口可变**
传输层有三种窗口：
    接收窗口rwnd：接收方根据缓存大小动态调节的
    拥塞窗口cwnd：接收方根据网络拥塞程度估计的
    发送窗口=min{对方的rwnd，自己的cwnd}
    [注意接收窗口是对方的，拥塞窗口是自己的]

--------------------------------------
## 4.3.3 TCP拥塞控制
发送方看网络路径的拥塞情况（全网络）

拥塞控制通过控制拥塞窗口大小决定对方发送窗口大小，从而通过网络拥塞情况限制对方的发送速率，有两种方式：
    1. 慢开始与拥塞避免：[MSS是最大报文段长度]
        慢开始：cwnd初始为1MSS，以2倍指数式增长
        拥塞避免：当cwnd达到慢开始门限，变为线性增长
        出现网络拥塞时，慢开始门限=cwnd/2，cwnd置1
    -
    2. 快重传与快恢复：
        快重传：三个冗余ACK快速重传
        [说明出现了拥塞，同时也说明了使用快恢复技术]
        快恢复：cwnd减半，直接线性增长

**计算拥塞窗口，默认是慢开始与拥塞避免**
1. 当在慢开始时，发送拥塞窗口等于8的报文被接收，下一个报文还未发送，拥塞窗口已经变成了16
[注意-“这些报文均得到确认后”-这句话]
2. 区分清楚拥塞窗口大小与慢开始门限大小即可


# 第5/7层 应用层
C/S模型：所有应用层以下的协议都是该模型
P2P模型：（对等式）可扩展性好，健壮性强

递归查询：深度优先查询
迭代查询：广度优先查询

域名与IP，MAC，主机地址都不是一一对应的关系，是多对多的关系

主机一定要有IP，但不一定要有域名

主机访问www.bupt.edu.cn
使用迭代查询，本地域名服务器访问顺序：
根服务器->cn(顶级)->edu.cn(权限)->bupt.edu.cn(权限) 总共有四次查询
使用递归查询：也是要逐个访问这几个服务器
但是本地服务器只与根服务器打交道，深度嵌套的

---------------------------------------------
电子邮件三部分：
    用户代理：用户与邮件系统的接口
    邮件服务器：发送与接收邮件
    发送与读取协议：SMTP与POP3
**两段用SMTP，一段用POP3**

邮件的信封由系统填写
内容=首部+主体

SMTP只能传输ASCII码，MIME转化为中文

SMTP与POP3都是TCP可靠传输
POP3使用明文传递密码

用浏览器发送邮件，使用的是HTTP协议
在不同邮件服务器中才使用SMTP

----------------------------------------------
www是万维网，是统一的资源空间
URL是统一资源定位符，用于标识全网每个文档
HTTP是超文本传输协议，工作于应用层，使用TCP可靠传输
HTML是超文本标记语言，类似于md
[URL形式=协议://主机:端口/路径]

HTTP/1.1是持久连接，1.0是非持久连接

每次所说的端口号80是服务器指定的端口号，客户端端口号是由客户端进程随意指定的

互联网：所有网络的集合，是个概念
因特网：因特网是互联网集合中最大的网络
万维网：万维网是各种资源网页的集合，是因特网的主要部分
**HTTP的报文结构会出大题**
